

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: lib/utils.js | Gallery</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">
    <link type="text/css" rel="stylesheet" href="styles/videojs.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 50px; height: 50px">
        
            <img src="https://brightcovelearning.github.io/Brightcove-API-References/brightcove-player/doc-header-image/bc-logo.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Gallery</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="ClientApi.html">ClientApi</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ClientApi_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="ClientApi.html#getAllVideos">getAllVideos</a></li><li><a href="ClientApi.html#getCurrentState">getCurrentState</a></li><li><a href="ClientApi.html#getCurrentVideo">getCurrentVideo</a></li><li><a href="ClientApi.html#off">off</a></li><li><a href="ClientApi.html#on">on</a></li><li><a href="ClientApi.html#once">once</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="ClientApi.html#event:interactionCardPanelClose">interactionCardPanelClose</a></li><li><a href="ClientApi.html#event:interactionCardPanelOpen">interactionCardPanelOpen</a></li><li><a href="ClientApi.html#event:interactionClick">interactionClick</a></li><li><a href="ClientApi.html#event:interactionEnd">interactionEnd</a></li><li><a href="ClientApi.html#event:interactionStart">interactionStart</a></li><li><a href="ClientApi.html#event:playerChanged">playerChanged</a></li><li><a href="ClientApi.html#event:playerLoaded">playerLoaded</a></li><li><a href="ClientApi.html#event:stateChanged">stateChanged</a></li><li><a href="ClientApi.html#event:videoChanged">videoChanged</a></li><li><a href="ClientApi.html#event:videoLoaded">videoLoaded</a></li><li><a href="ClientApi.html#event:videoPaused">videoPaused</a></li><li><a href="ClientApi.html#event:videoStarted">videoStarted</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="ClientApi.html#~InteractivityEvent">InteractivityEvent</a></li><li><a href="ClientApi.html#~Player">Player</a></li><li><a href="ClientApi.html#~Video">Video</a></li></ul></div></li><li><a href="VideoFetcher.html">VideoFetcher</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="VideoFetcher_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="VideoFetcher.html#getVideo">getVideo</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="VideoFetcher.html#emitError">emitError</a></li><li><a href="VideoFetcher.html#emitVideos">emitVideos</a></li><li><a href="VideoFetcher.html#fetch">fetch</a></li><li><a href="VideoFetcher.html#fetchConfigurationVideos">fetchConfigurationVideos</a></li><li><a href="VideoFetcher.html#fetchLiveVodVideos">fetchLiveVodVideos</a></li><li><a href="VideoFetcher.html#fetchManualVideos">fetchManualVideos</a></li><li><a href="VideoFetcher.html#fetchPlaylistVideos">fetchPlaylistVideos</a></li><li><a href="VideoFetcher.html#isExperienceConfigValid">isExperienceConfigValid</a></li><li><a href="VideoFetcher.html#noVideos">noVideos</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="VideoFetcher.html#event:videoError">videoError</a></li><li><a href="VideoFetcher.html#event:videos">videos</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#connect">connect</a></li><li><a href="global.html#deepEqual">deepEqual</a></li><li><a href="global.html#ensureExplicitProtocol">ensureExplicitProtocol</a></li><li><a href="global.html#ensureProtocol">ensureProtocol</a></li><li><a href="global.html#escapeForHtml">escapeForHtml</a></li><li><a href="global.html#escapeForRegex">escapeForRegex</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getAllVideosFromState">getAllVideosFromState</a></li><li><a href="global.html#getCssUrl">getCssUrl</a></li><li><a href="global.html#getFontResizeFunction">getFontResizeFunction</a></li><li><a href="global.html#getFontSize">getFontSize</a></li><li><a href="global.html#getHelperTextKey">getHelperTextKey</a></li><li><a href="global.html#getIn">getIn</a></li><li><a href="global.html#getLocation">getLocation</a></li><li><a href="global.html#getMinMaxFontSizes">getMinMaxFontSizes</a></li><li><a href="global.html#getPlaylist">getPlaylist</a></li><li><a href="global.html#getPoster">getPoster</a></li><li><a href="global.html#getReferrer">getReferrer</a></li><li><a href="global.html#getSourceUrl">getSourceUrl</a></li><li><a href="global.html#getSwipeOffset">getSwipeOffset</a></li><li><a href="global.html#getSwipeVideoChange">getSwipeVideoChange</a></li><li><a href="global.html#getThumbnail">getThumbnail</a></li><li><a href="global.html#getUrlForVideo">getUrlForVideo</a></li><li><a href="global.html#getVideosArrayFromState">getVideosArrayFromState</a></li><li><a href="global.html#getVideosFromState">getVideosFromState</a></li><li><a href="global.html#getVideosFromStateForConfig">getVideosFromStateForConfig</a></li><li><a href="global.html#getVideosOrEmpty">getVideosOrEmpty</a></li><li><a href="global.html#hasProtocol">hasProtocol</a></li><li><a href="global.html#isDataProp">isDataProp</a></li><li><a href="global.html#isNonNullObject">isNonNullObject</a></li><li><a href="global.html#isSecure">isSecure</a></li><li><a href="global.html#joinStyleClassNames">joinStyleClassNames</a></li><li><a href="global.html#maxNonNull">maxNonNull</a></li><li><a href="global.html#merge">merge</a></li><li><a href="global.html#mergeIn">mergeIn</a></li><li><a href="global.html#minNonNull">minNonNull</a></li><li><a href="global.html#noVideos">noVideos</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#parseQueryString">parseQueryString</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#sameMembers">sameMembers</a></li><li><a href="global.html#selectHtmlProps">selectHtmlProps</a></li><li><a href="global.html#selectProps">selectProps</a></li><li><a href="global.html#selectSvgProps">selectSvgProps</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setFontSizes">setFontSizes</a></li><li><a href="global.html#setIn">setIn</a></li><li><a href="global.html#shallowEqual">shallowEqual</a></li><li><a href="global.html#shallowEqualArray">shallowEqualArray</a></li><li><a href="global.html#stringify">stringify</a></li><li><a href="global.html#stringifyQuery">stringifyQuery</a></li><li><a href="global.html#toQueryString">toQueryString</a></li><li><a href="global.html#updateTextSize">updateTextSize</a></li><li class="hidden"><a href="global.html#URLParts">URLParts</a></li><li><a href="global.html#videoConfigHasChanged">videoConfigHasChanged</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const document = require('global/document');
const redux = require('react-redux');
const Analytics = require('./analytics');
const userAgent = require('./userAgent');
const { getIn } = require('./immutable');
const i18n = require('../i18n');

// Props list from https://facebook.github.io/react/docs/dom-elements.html
const eventHandlers = new Set(['onKeyPress', 'onKeyUp', 'onKeyDown', 'onClick','onContextMenu','onDoubleClick','onDrag','onDragEnd','onDragEnter','onDragExit','onDragLeave','onDragOver','onDragStart','onDrop','onMouseDown','onMouseEnter','onMouseLeave','onMouseMove','onMouseOut','onMouseOver','onMouseUp']);
const safeHtmlProps = new Set(['aria-haspopup', 'aria-expanded', 'children', 'accept','acceptCharset','accessKey','action','allowFullScreen','allowTransparency','alt','async','autoComplete','autoFocus','autoPlay','capture','cellPadding','cellSpacing','challenge','charSet','checked','cite','classID','className','colSpan','cols','content','contentEditable','contextMenu','controls','coords','crossOrigin','data','dateTime','default','defer','dir','disabled','download','draggable','encType','form','formAction','formEncType','formMethod','formNoValidate','formTarget','frameBorder','headers','height','hidden','high','href','hrefLang','htmlFor','httpEquiv','icon','id','inputMode','integrity','is','keyParams','keyType','kind','label','lang','list','loop','low','manifest','marginHeight','marginWidth','max','maxLength','media','mediaGroup','method','min','minLength','multiple','muted','name','noValidate','nonce','open','optimum','pattern','placeholder','poster','preload','profile','radioGroup','readOnly','rel','required','reversed','role','rowSpan','rows','sandbox','scope','scoped','scrolling','seamless','selected','shape','size','sizes','span','spellCheck','src','srcDoc','srcLang','srcSet','start','step','style','summary','tabIndex','target','title','type','useMap','value','width','wmode','wrap']);
const safeSvgProps = new Set(['children', 'accentHeight','accumulate','additive','alignmentBaseline','allowReorder','alphabetic','amplitude','arabicForm','ascent','attributeName','attributeType','autoReverse','azimuth','baseFrequency','baseProfile','baselineShift','bbox','begin','bias','by','calcMode','capHeight','clip','clipPath','clipPathUnits','clipRule','colorInterpolation','colorInterpolationFilters','colorProfile','colorRendering','contentScriptType','contentStyleType','cursor','cx','cy','d','decelerate','descent','diffuseConstant','direction','display','divisor','dominantBaseline','dur','dx','dy','edgeMode','elevation','enableBackground','end','exponent','externalResourcesRequired','fill','fillOpacity','fillRule','filter','filterRes','filterUnits','floodColor','floodOpacity','focusable','fontFamily','fontSize','fontSizeAdjust','fontStretch','fontStyle','fontVariant','fontWeight','format','from','fx','fy','g1','g2','glyphName','glyphOrientationHorizontal','glyphOrientationVertical','glyphRef','gradientTransform','gradientUnits','hanging','horizAdvX','horizOriginX','ideographic','imageRendering','in','in2','intercept','k','k1','k2','k3','k4','kernelMatrix','kernelUnitLength','kerning','keyPoints','keySplines','keyTimes','lengthAdjust','letterSpacing','lightingColor','limitingConeAngle','local','markerEnd','markerHeight','markerMid','markerStart','markerUnits','markerWidth','mask','maskContentUnits','maskUnits','mathematical','mode','numOctaves','offset','opacity','operator','order','orient','orientation','origin','overflow','overlinePosition','overlineThickness','paintOrder','panose1','pathLength','patternContentUnits','patternTransform','patternUnits','pointerEvents','points','pointsAtX','pointsAtY','pointsAtZ','preserveAlpha','preserveAspectRatio','primitiveUnits','r','radius','refX','refY','renderingIntent','repeatCount','repeatDur','requiredExtensions','requiredFeatures','restart','result','rotate','rx','ry','scale','seed','shapeRendering','slope','spacing','specularConstant','specularExponent','speed','spreadMethod','startOffset','stdDeviation','stemh','stemv','stitchTiles','stopColor','stopOpacity','strikethroughPosition','strikethroughThickness','string','stroke','strokeDasharray','strokeDashoffset','strokeLinecap','strokeLinejoin','strokeMiterlimit','strokeOpacity','strokeWidth','surfaceScale','systemLanguage','tableValues','targetX','targetY','textAnchor','textDecoration','textLength','textRendering','to','transform','u1','u2','underlinePosition','underlineThickness','unicode','unicodeBidi','unicodeRange','unitsPerEm','vAlphabetic','vHanging','vIdeographic','vMathematical','values','vectorEffect','version','vertAdvY','vertOriginX','vertOriginY','viewBox','viewTarget','visibility','widths','wordSpacing','writingMode','x','x1','x2','xChannelSelector','xHeight','xlinkActuate','xlinkArcrole','xlinkHref','xlinkRole','xlinkShow','xlinkTitle','xlinkType','xmlBase','xmlLang','xmlSpace','y','y1','y2','yChannelSelector','z','zoomAndPan']);

/**
 * Checks whether the prop is a data-* or aria-* property
 */
function isDataProp (prop) {
  return /^(?:data|aria)-./.test(prop);
}

function isSafeHtmlProp (prop) {
  return isDataProp(prop) || safeHtmlProps.has(prop) || eventHandlers.has(prop);
}

function isSafeSvgProp (prop) {
  return isDataProp(prop) || safeSvgProps.has(prop) || eventHandlers.has(prop);
}

function loadScript (src, doc = document) {
  return new Promise(resolve => {
    const tag = doc.createElement('script');
    const firstScriptTag = doc.getElementsByTagName('script')[0];
    if (firstScriptTag) {
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    } else {
      doc.body.appendChild(tag);
    }
    tag.onload = resolve;
    tag.onreadystatechange = function () {
      if (this.readyState === 'complete' || this.readyState === 'loaded') {
        resolve();
      }
    };
    tag.src = src;
  });
}

function setIn (target, path, value) {
  const parts = path.slice();
  while (parts.length > 1) {
    const part = parts.shift();
    if (!target[part]) {
      target[part] = {};
    }
    target = target[part];
  }
  target[parts[0]] = value;
}

/**
 * Wraps redux.connect to connect a component to the store while providing some global props and a way to access
 * both the unconnected and the connected component.
 *
 * @param {function} mapStateToProps Function to map state properties to component props
 * @returns {function(React.PureComponent): React.PureComponent} Wrapped component
 */
function connect (mapStateToProps) {
  const connect = redux.connect((state, ownProps) => {
    const adPlaying = getIn(state, ['player', 'adPlaying']);
    const analytics = Analytics.get(state.config.experience, state.activeView);
    const t = i18n(getIn(state, ['config', 'experience', 'locale']));
    let tEditor;
    if (__EDITOR__) {
      tEditor = i18n(state.editorLocale);
    }
    const props = { analytics, t, tEditor, adPlaying };
    if (mapStateToProps) {
      return Object.assign(props, mapStateToProps(state, ownProps));
    }
    return props;
  });

  return (component) => Object.assign(component, {
    Connected: connect(component),
    mapStateToProps,
  });
}

function joinClasses (...classNames) {
  return classNames.filter(Boolean).join(' ');
}

/**
 * Filters props using a filter function and returns an object with props that pass the filter
 */
function selectProps (props, filter) {
  return Object.keys(props)
    .filter(filter)
    .reduce((obj, key) => Object.assign(obj, {
      [key]: props[key],
    }), {});
}

/**
 * Filters props object and returns an object with only props that are safe for
 * DOM elements
 * @param props A key-value object of props
 * @returns {object} A props object of key-value pairs that can be safely passed
 * to a React DOM component without warning.
 */
function selectHtmlProps (props) {
  return selectProps(props, isSafeHtmlProp);
}

/**
 * Filters props object and returns an object with only props that are safe for
 * SVG elements
 * @param props A key-value object of props
 * @returns {object} A props object of key-value pairs that can be safely passed
 * to a React SVG component without warning.
 */
function selectSvgProps (props) {
  return selectProps(props, isSafeSvgProp);
}

function ensureArray (val) {
  if (val == null) {
    return [];
  }
  if (!Array.isArray(val)) {
    return [val];
  }
  return val;
}

function getFrameContentSize (iframe) {
  const doc = iframe.contentDocument;
  if (!doc) {
    return {};
  }
  const body = doc.body;
  const html = doc.documentElement;
  const bodyBounding = body.getBoundingClientRect();
  const htmlBounding = html.getBoundingClientRect();
  const height = userAgent.isIE10 ? Math.ceil(bodyBounding.height) : htmlBounding.height;
  const width = Math.max(body.scrollWidth, body.offsetWidth, html.clientWidth,
    html.scrollWidth, html.offsetWidth, bodyBounding.width, htmlBounding.width);
  return { height, width };
}

function cloneScripts (root) {
  for (let i = 0; i &lt; root.childNodes.length; ++i) {
    const node = root.childNodes[i];
    if (node.tagName &amp;&amp; node.tagName.toLowerCase() === 'script') {
      const script = document.createElement('script');
      for (let j = 0; j &lt; node.attributes.length; ++j) {
        script.setAttribute(node.attributes[j].name, node.attributes[j].value);
      }
      script.innerHTML = node.innerHTML;
      root.replaceChild(script, node);
    } else {
      cloneScripts(node);
    }
  }
}

function stripScripts (root) {
  for (let i = root.childNodes.length - 1; i >= 0; --i) {
    const node = root.childNodes[i];
    if (node.tagName &amp;&amp; node.tagName.toLowerCase() === 'script') {
      root.removeChild(node);
      continue;
    }

    const attributes = node.attributes;
    if (attributes) {
      for (let j = 0; j &lt; attributes.length; ++j) {
        if (/^on/i.test(attributes[j].name)) {
          node.removeAttribute(attributes[j].name);
        }
      }
    }
    stripScripts(node);
  }
}

function getHtmlContent (html, withScripts) {
  const div = document.createElement('div');
  div.innerHTML = html;
  if (withScripts &amp;&amp; !__EDITOR__) {
    cloneScripts(div);
  } else {
    stripScripts(div);
  }
  return div;
}

function injectHtml (root, html) {
  const div = getHtmlContent(html, true);
  const nodes = [];
  while (div.firstChild) {
    nodes.push(div.firstChild);
    root.appendChild(div.firstChild);
  }
  return nodes;
}

function removeHtml (nodelist) {
  (nodelist || []).forEach(node => {
    node.parentNode.removeChild(node);
  });
}

function insertNode (node, doc, insertBeforeNode) {
  if (insertBeforeNode) {
    return insertBeforeNode.parentNode.insertBefore(node, insertBeforeNode);
  }
  doc.getElementsByTagName('head')[0].appendChild(node);
}

function injectJs (doc, js, insertBeforeNode) {
  if (!js || __EDITOR__) {
    return null;
  }
  const script = doc.createElement('script');
  script.innerHTML = js;
  insertNode(script, doc, insertBeforeNode);
  return script;
}

function injectJsUrl (doc, url, insertBeforeNode) {
  if (!url || __EDITOR__) {
    return null;
  }
  const script = doc.createElement('script');
  script.src = url;
  insertNode(script, doc, insertBeforeNode);
  return script;
}

function injectJsonLd (doc, js, insertBeforeNode) {
  if (!js || __EDITOR__) {
    return null;
  }
  const script = doc.createElement('script');
  script.type = 'application/ld+json';
  script.innerHTML = js;
  insertNode(script, doc, insertBeforeNode);
  return script;
}

function injectCss (doc, css, insertBeforeNode) {
  if (!css) {
    return null;
  }
  const style = doc.createElement('style');
  style.type = 'text/css';
  insertNode(style, doc, insertBeforeNode);
  //Do NOT use styleSheet.cssText here as it causes issues with injecting styles in IE
  style.appendChild(doc.createTextNode(css));

  return style;
}

function injectCssUrl (doc, url, insertBeforeNode) {
  if (!url) {
    return null;
  }
  const link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = url;
  insertNode(link, doc, insertBeforeNode);
  return link;
}

function getCssString (str) {
  return `"${str.replace(/(["\\])/g, '\\$1')}"`;
}

/**
 * Safely generates a CSS URL string
 */
function getCssUrl (url) {
  return `url(${getCssString(url)})`;
}

/**
 * Generate a query string from an object
 */

/**
 * Get the class names associated with a particular style name and merges them with existing class names
 */
function joinStyleClassNames (styleName, ...classNames) {
  if (!styleName) {
    return joinClasses(...classNames);
  }
  return joinClasses(`ee-components-style-${styleName}`, ...classNames);
}

function isComponentBehindLightbox (component, props = component.props) {
  return !component.context.eeComponentsLightbox &amp;&amp; props.lightboxView != null;
}

function isActiveComponent (component, props = component.props) {
  const { eeComponentsViews, eeComponentsLightbox } = component.context;
  const activeView = eeComponentsLightbox ? props.lightboxView : props.activeView;

  return !props.hidden &amp;&amp; (!eeComponentsViews || eeComponentsViews.includes(activeView));
}

function getInteractionName (interaction) {
  switch (interaction.type) {
    case 'Link': return interaction.text || interaction.href || 'Link';
    case 'Card': return interaction.title || 'Card';
    case 'External': return interaction.content[0] &amp;&amp; (
      interaction.content[0].name || interaction.content[0].type
    ) || 'On-Page';
  }
  return 'Dynamic Content';
}

function clamp (num, min, max) {
  return Math.min(max, Math.max(min, num));
}

function preventDefault (event) {
  if (__EDITOR__) {
    event.preventDefault();
  }
  event.stopPropagation();
}

function isFileDragging (event) {
  return getIn(event, ['dataTransfer', 'items', 0, 'kind']) === 'file';
}

function getTextFromFile (file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onerror = () => reject(reader.error);
    reader.onload = () => resolve(reader.result);
    reader.readAsText(file);
  });
}

function getImageFromFile (file) {
  return {
    file,
    preview: window.URL.createObjectURL(file),
  };
}

function getIfNotNull (obj, prop, defaultVal) {
  return obj[prop] != null ? obj[prop] : defaultVal;
}

module.exports = {
  loadScript,
  setIn,
  connect,
  joinClasses,
  selectHtmlProps,
  selectSvgProps,
  ensureArray,
  getFrameContentSize,
  getHtmlContent,
  injectHtml,
  removeHtml,
  getCssUrl,
  getCssString,
  injectCss,
  injectCssUrl,
  injectJs,
  injectJsUrl,
  injectJsonLd,
  joinStyleClassNames,
  isActiveComponent,
  isComponentBehindLightbox,
  getInteractionName,
  clamp,
  preventDefault,
  isFileDragging,
  getTextFromFile,
  getImageFromFile,
  getIfNotNull,
};
</code></pre>
        </article>
    </section>




</div>

    <footer>
        <img class="logo" src="https://brightcovelearning.github.io/Brightcove-API-References/brightcove-player/doc-header-image/bc-logo.png" style="width: 50px; height: 46px">
        <div class="footer-text"><span class='copyright'>©2018 <a href='https://brightcove.com' target='_blank'>Brightcove, Inc</a>.</div>
    </footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
