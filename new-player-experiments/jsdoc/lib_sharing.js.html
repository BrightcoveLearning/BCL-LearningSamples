

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: lib/sharing.js | Gallery</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">
    <link type="text/css" rel="stylesheet" href="styles/videojs.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 50px; height: 50px">
        
            <img src="https://brightcovelearning.github.io/Brightcove-API-References/brightcove-player/doc-header-image/bc-logo.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Gallery</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="ClientApi.html">ClientApi</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ClientApi_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="ClientApi.html#getAllVideos">getAllVideos</a></li><li><a href="ClientApi.html#getCurrentState">getCurrentState</a></li><li><a href="ClientApi.html#getCurrentVideo">getCurrentVideo</a></li><li><a href="ClientApi.html#off">off</a></li><li><a href="ClientApi.html#on">on</a></li><li><a href="ClientApi.html#once">once</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="ClientApi.html#event:interactionCardPanelClose">interactionCardPanelClose</a></li><li><a href="ClientApi.html#event:interactionCardPanelOpen">interactionCardPanelOpen</a></li><li><a href="ClientApi.html#event:interactionClick">interactionClick</a></li><li><a href="ClientApi.html#event:interactionEnd">interactionEnd</a></li><li><a href="ClientApi.html#event:interactionStart">interactionStart</a></li><li><a href="ClientApi.html#event:playerChanged">playerChanged</a></li><li><a href="ClientApi.html#event:playerLoaded">playerLoaded</a></li><li><a href="ClientApi.html#event:stateChanged">stateChanged</a></li><li><a href="ClientApi.html#event:videoChanged">videoChanged</a></li><li><a href="ClientApi.html#event:videoLoaded">videoLoaded</a></li><li><a href="ClientApi.html#event:videoPaused">videoPaused</a></li><li><a href="ClientApi.html#event:videoStarted">videoStarted</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="ClientApi.html#~InteractivityEvent">InteractivityEvent</a></li><li><a href="ClientApi.html#~Player">Player</a></li><li><a href="ClientApi.html#~Video">Video</a></li></ul></div></li><li><a href="VideoFetcher.html">VideoFetcher</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="VideoFetcher_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="VideoFetcher.html#getVideo">getVideo</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="VideoFetcher.html#emitError">emitError</a></li><li><a href="VideoFetcher.html#emitVideos">emitVideos</a></li><li><a href="VideoFetcher.html#fetch">fetch</a></li><li><a href="VideoFetcher.html#fetchConfigurationVideos">fetchConfigurationVideos</a></li><li><a href="VideoFetcher.html#fetchLiveVodVideos">fetchLiveVodVideos</a></li><li><a href="VideoFetcher.html#fetchManualVideos">fetchManualVideos</a></li><li><a href="VideoFetcher.html#fetchPlaylistVideos">fetchPlaylistVideos</a></li><li><a href="VideoFetcher.html#isExperienceConfigValid">isExperienceConfigValid</a></li><li><a href="VideoFetcher.html#noVideos">noVideos</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="VideoFetcher.html#event:videoError">videoError</a></li><li><a href="VideoFetcher.html#event:videos">videos</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#connect">connect</a></li><li><a href="global.html#deepEqual">deepEqual</a></li><li><a href="global.html#ensureExplicitProtocol">ensureExplicitProtocol</a></li><li><a href="global.html#ensureProtocol">ensureProtocol</a></li><li><a href="global.html#escapeForHtml">escapeForHtml</a></li><li><a href="global.html#escapeForRegex">escapeForRegex</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getAllVideosFromState">getAllVideosFromState</a></li><li><a href="global.html#getCssUrl">getCssUrl</a></li><li><a href="global.html#getFontResizeFunction">getFontResizeFunction</a></li><li><a href="global.html#getFontSize">getFontSize</a></li><li><a href="global.html#getHelperTextKey">getHelperTextKey</a></li><li><a href="global.html#getIn">getIn</a></li><li><a href="global.html#getLocation">getLocation</a></li><li><a href="global.html#getMinMaxFontSizes">getMinMaxFontSizes</a></li><li><a href="global.html#getPlaylist">getPlaylist</a></li><li><a href="global.html#getPoster">getPoster</a></li><li><a href="global.html#getReferrer">getReferrer</a></li><li><a href="global.html#getSourceUrl">getSourceUrl</a></li><li><a href="global.html#getSwipeOffset">getSwipeOffset</a></li><li><a href="global.html#getSwipeVideoChange">getSwipeVideoChange</a></li><li><a href="global.html#getThumbnail">getThumbnail</a></li><li><a href="global.html#getUrlForVideo">getUrlForVideo</a></li><li><a href="global.html#getVideosArrayFromState">getVideosArrayFromState</a></li><li><a href="global.html#getVideosFromState">getVideosFromState</a></li><li><a href="global.html#getVideosFromStateForConfig">getVideosFromStateForConfig</a></li><li><a href="global.html#getVideosOrEmpty">getVideosOrEmpty</a></li><li><a href="global.html#hasProtocol">hasProtocol</a></li><li><a href="global.html#isDataProp">isDataProp</a></li><li><a href="global.html#isNonNullObject">isNonNullObject</a></li><li><a href="global.html#isSecure">isSecure</a></li><li><a href="global.html#joinStyleClassNames">joinStyleClassNames</a></li><li><a href="global.html#maxNonNull">maxNonNull</a></li><li><a href="global.html#merge">merge</a></li><li><a href="global.html#mergeIn">mergeIn</a></li><li><a href="global.html#minNonNull">minNonNull</a></li><li><a href="global.html#noVideos">noVideos</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#parseQueryString">parseQueryString</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#sameMembers">sameMembers</a></li><li><a href="global.html#selectHtmlProps">selectHtmlProps</a></li><li><a href="global.html#selectProps">selectProps</a></li><li><a href="global.html#selectSvgProps">selectSvgProps</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setFontSizes">setFontSizes</a></li><li><a href="global.html#setIn">setIn</a></li><li><a href="global.html#shallowEqual">shallowEqual</a></li><li><a href="global.html#shallowEqualArray">shallowEqualArray</a></li><li><a href="global.html#stringify">stringify</a></li><li><a href="global.html#stringifyQuery">stringifyQuery</a></li><li><a href="global.html#toQueryString">toQueryString</a></li><li><a href="global.html#updateTextSize">updateTextSize</a></li><li class="hidden"><a href="global.html#URLParts">URLParts</a></li><li><a href="global.html#videoConfigHasChanged">videoConfigHasChanged</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const constants = require('../constants');
const page = require('./page');
const urlLib = require('./url');
const { toQueryString, ensureExplicitProtocol } = require('./url');
const videoLib = require('./video');
const { get, getIn } = require('./immutable');

function getDeepLinkParameter (experience) {
  return getIn(experience, ['social', 'deepLinkParameter']) || constants.defaults.deepLinkParameter;
}

function getBaseUrl (experience) {
  return get(experience, 'shareBaseUrl') || constants.baseUrls.share;
}

function getUrlForEvent (experience) {
  const params = {
    url: page.getLocation(),
    accountId: experience.accountId,
    experienceId: experience.id,
  };
  return `${getBaseUrl(experience)}?${urlLib.stringifyQuery(params)}`;
}

/**
 * Gets the URL of the embedded deep-linked video
 */
function getUrlForVideo (experience, videoId) {
  const url = urlLib.parse(page.getLocation());
  const query = urlLib.parseQueryString(url.search);

  query[getDeepLinkParameter(experience)] = videoId;
  url.search = `?${urlLib.stringifyQuery(query)}`;

  const params = {
    url: urlLib.stringify(url),
    accountId: experience.accountId,
    experienceId: experience.id,
    videoId,
  };
  return `${getBaseUrl(experience)}?${urlLib.stringifyQuery(params)}`;
}

function facebook (name, description, link, image) {
  const qs = {
    app_id: constants.social.facebookAppId,
    display: 'popup',
    name,
    link,
    //Need a no breaking space if no description so that garbage isn't inserted
    description: description || '\u00A0',
  };
  if (image) {
    qs.picture = image;
  }
  return `https://www.facebook.com/dialog/feed${toQueryString(qs)}`;
}

function googlePlus (url) {
  return `https://plus.google.com/share${toQueryString({ url })}`;
}

function twitter (text) {
  return `https://twitter.com/intent/tweet${toQueryString({ text })}`;
}

function linkedIn (title, description, url) {
  const qs = {
    mini: 'true',
    url,
    title,
    summary: description || '',
  };
  return `https://www.linkedin.com/shareArticle${toQueryString(qs)}`;
}

function pinterest (description, url, image) {
  const qs = {
    url,
    description: description || '',
  };
  if (image) {
    qs.media = image;
  }
  return `https://pinterest.com/pin/create/button/${toQueryString(qs)}`;
}

function email (subject, description, url, body) {
  if (!body) {
    if (description) {
      body = `${description}\n\n${url}`;
    } else {
      body = url;
    }
  }
  const qs = {
    subject,
    body,
  };

  return `mailto:${toQueryString(qs)}`;
}

function getCustomMessage (option, tokenMap) {
  const { useCustomMessage, customMessage } = option || {};
  if (!useCustomMessage || !customMessage) {
    return null;
  }
  return customMessage.replace(/\[\[([^\]]+)\]\]/g, (match, token) => {
    if (tokenMap.hasOwnProperty(token)) {
      return tokenMap[token] || '';
    }
    return match;
  });
}

function getLink (name, title, description, url, customMessage, image, defaultTwitterMessage) {
  if (image) {
    image = ensureExplicitProtocol(image);
  }
  switch (name) {
    case 'facebook': return facebook(title, customMessage || description, url, image);
    case 'googlePlus': return googlePlus(url);
    case 'twitter': return twitter(customMessage || `${defaultTwitterMessage} ${url}`);
    case 'linkedIn': return linkedIn(title, customMessage || description, url);
    case 'pinterest': return pinterest(customMessage || description, url, image);
    case 'email': return email(title, description, url, customMessage);
  }
}

function getVideoLink (experience, name, video, options, t) {
  if (!video || !video.id) {
    return null;
  }

  //Fetch the video URL
  const url = getUrlForVideo(experience, video.id);

  //Get the video image (for facebook / pinterest)
  const image = videoLib.getPoster(video);

  //Custom message handling
  const message = getCustomMessage(options[name], {
    'PAGE_URL': page.getLocation(),
    'VIDEO_URL': url,
    'VIDEO_TITLE': video.name,
    'VIDEO_SHORT_DESC': video.description,
  });

  return getLink(name, video.name, video.description, url, message, image, t('check_out_this_video'));
}

function getEventLink (experience, name, options, t) {
  const eventSocial = getIn(experience, ['event', 'social']);
  if (!eventSocial) {
    return null;
  }
  const { title, description, image } = eventSocial;

  //Fetch the page URL
  const url = getUrlForEvent(experience);

  //Custom message handling
  const message = getCustomMessage(options[name], {
    'PAGE_URL': url,
    'EVENT_TITLE': eventSocial.title,
    'EVENT_DESC': eventSocial.description,
  });

  return getLink(name, title, description, url, message, image, t('check_out_this_event'));
}

function isSharingEnabled (experience, shareType, sharePlacement) {
  if (!constants.sharePositionValues.includes(sharePlacement) || sharePlacement === constants.sharePositions.none) {
    return false;
  }

  return constants.social.options.some(name => {
    return getIn(experience, getSocialPath(shareType, 'sharingOptions', name, 'enabled'));
  });
}

function getSocialPath (shareType, ...additional) {
  const socialPath = ['social', ...additional];
  if (shareType === constants.social.shareTypes.event) {
    socialPath.unshift('event');
  }
  return socialPath;
}

module.exports = {
  getVideoLink,
  getEventLink,
  getUrlForEvent,
  getUrlForVideo,
  isSharingEnabled,
  getSocialPath,
};
</code></pre>
        </article>
    </section>




</div>

    <footer>
        <img class="logo" src="https://brightcovelearning.github.io/Brightcove-API-References/brightcove-player/doc-header-image/bc-logo.png" style="width: 50px; height: 46px">
        <div class="footer-text"><span class='copyright'>©2018 <a href='https://brightcove.com' target='_blank'>Brightcove, Inc</a>.</div>
    </footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
