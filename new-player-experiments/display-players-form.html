<!DOCTYPE html>
<html lang="en">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title id="bclPageTitle">Media API Sample: search_videos</title>
    <link href="/en/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href="//files.brightcove.com/proxima-nova/font-faces.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/github.css" />
    <link rel="stylesheet" type="text/css" href="/en/styles/anytime.5.0.0-1401232312.min.css" />
  <script type="text/javascript">
  <!--//--><![CDATA[//><!--
	var _gaq = _gaq || [];
	_gaq.push(
		["_setAccount", "UA-2728311-23"],
		["_setDomainName", ".brightcove.com"],
		["_trackPageview"]
	);
	(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
  </script>
  </head>

  <body data-spy="scroll" data-target=".sub-menu" data-offset="100">
  <!-- header navbar -->
    <div id="titleBar" class="navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div id="otherSites">
          <ul class="nav pull-right small">
            <li><a href="//brightcove.com">BRIGHTCOVE.COM</a></li>
            <li><a href="//support.brightcove.com">SUPPORT</a></li>
            <li><a href="//support.brightcove.com/video-cloud/training-videos">TRAINING VIDEOS</a></li>
          </ul>
        </div>
        <a class="brand" href="//docs.brightcove.com/en/index.html">BRIGHTCOVE DEVELOPER DOCUMENTATION</a>
       </div>
     </div>
     <!-- end header navbar -->
     <!-- nav navbar -->
     <div id="navBar" class="navbar-inverse navbar-fixed-top">
     <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <a class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <!-- Everything you want hidden at 940px or less, place within here -->
      <ul id="sectionNav" class="nav">
      </ul>
     </div>
    </div>
    <!-- end nav navbar -->
  <!-- Content ============================================= -->
    <div class="row">
      <div id="sidenav" class="span2"></div>
      <div id="main" class="span10">
        <div id="top" class="section">
            <h1 id="bclPageHeading">Media API Sample: search_videos</h1>
            <p>This example uses the <code>search_videos()</code> READ method, which allows you to perform complex searches for videos. You can search any standard or custom data field, and you can have multiple <code>all</code>, <code>any</code>, and <code>none</code> terms to include and exclude videos from the search results.</p>
            <p>All READ method samples are made using the <a href="//docs.brightcove.com/en/video-cloud/open-source/">JavaScript MAPI wrapper</a>.</p>
            <p class="text-warning">Note that making this call from the client side exposes your read token, which could allow a developer to access all video data from your account. If you use the READ token with URL access, that developer could even download copies of all your video files. Brightcove recommends making all Media API calls from a server-side application if possible.</p>
          </div>
          <div class="section">
            <h2>Search Input</h2>
            <p>Read token: <input name="token" id="token" type="text" size="100" value="ZY4Ls9Hq6LCBgleGDTaFRDLWWBC8uoXQun0xEEXtlDUHBDPZBCOzbw.."></p>
            <p>Service URL: <input name="url" id="url" type="text" size="100" value="//api.brightcove.com/services/library"></p>
            <p>Return videos that have <code>all</code> of these terms:<br /><input name="all" id="all" type="text" size="100" value="water"></p>
            <p>Return videos that have <code>any</code> of these terms:<br /><input name="any" id="any" type="text" size="100" value="tag:sea,tag:fish"></p>
            <p>Return videos that have <code>none</code> of these terms:<br /><input name="none" id="none" type="text" size="100" value="private"></p>
            <p>Sort by:
              <select id="sortBy">
                <option value="DISPLAY_NAME">Video Name</option>
                <option value="REFERENCE_ID">Reference ID</option>
                <option value="PUBLISH_DATE">Date Published</option>
                <option value="CREATION_DATE">Date Created</option>
                <option value="MODIFIED_DATE">Date Last Modified</option>
                <option value="START_DATE">Date Scheduled to Start</option>
                <option value="PLAYS_TRAILING_WEEK">Trailing Week Plays</option>
                <option value="PLAYS_TOTAL">All-Time Plays</option>
              </select>
              <select id="sortByOrder">
                <option value="ASC">Ascending</option>
                <option value="DESC">Descending</option>
              </select>
            </p>
            <p>Page size: <input name="pageSize" id="pageSize" type="text" size="10" value="5">
            &nbsp; Page number:
              <select id="pageNumber">
                <option>0</option>
              </select>
            </p>
            <p class="text-warning">Only the first page is available until you make a search; then the available pages are recalculated.</p>
            <p>Total items: <input name="totalItems" id="totalItems" type="text" readonly="readonly" value="???"></p>
            <p>Video fields to return:
              <select id="videoFields" multiple="multiple" size="10">
                <option selected="selected">id</option>
                <option selected="selected">name</option>
                <option selected="selected">shortDescription</option>
                <option>longDescription</option>
                <option>creationDate</option>
                <option>publishedDate</option>
                <option>lastModifiedDate</option>
                <option>linkURL</option>
                <option>linkText</option>
                <option>tags</option>
                <option>customFields</option>
                <option>cuePoints</option>
                <option>videoStillURL</option>
                <option>thumbnailURL</option>
                <option>referenceId</option>
                <option>length</option>
                <option>economics</option>
                <option>playsTotal</option>
                <option>playsTrailingWeek</option>
                <option>FLVURL</option>
                <option>renditions</option>
                <option>HLSURL</option>
                <option>FLVFullLength</option>
                <option>videoFullLength</option>
                <option>iOSRenditions</option>
                <option>captioning</option>
                  
                <option>adKeys</option>
                <option>digitalMaster</option>
                <option>logoOverlay</option>
                <option>thumbnail</option>
                <option>videoPreview</option>
                <option>videoStill</option>
                <option>accountId</option>
                <option>itemState</option>
                <option>startDate</option>
                <option>endDate</option>
                <option>geoRestricted</option>
                <option>geoFilteredCountries</option>
                <option>geoFilterExclude</option>
                <option>WVMRenditions</option>
              </select>
            </p>
            <p class="text-warning">You must use a read token with URL access to return <code>FLVURL</code>, <code>renditions</code>, <code>iOSRenditions</code>, <code>FLVFullLength</code>, and <code>videoFullLength</code>.</p>
            <p class="text-warning">The following fields are not returned unless they are explicityly included in the <code>video_fields</code> parameter: <code>iOSRenditions</code>, <code>captioning</code>, <code>digitalMaster</code>, <code>logoOverlay</code>, <code>thumbnail</code>, <code>videoPreview</code>, <code>videoStill</code>, <code>accountId</code>, <code>itemState</code>, <code>startDate</code>, <code>endDate</code>, <code>geoRestricted</code>, <code>geoFilteredCountries</code>, <code>geoFilterExclude</code>, <code>WVMRenditions</code> and <code>HLSURL</code>.</code>.</p>
            <p>Media delivery:
              <select id="mediaDelivery">
                <option>default</option>
                <option>http</option>
                <option>http_ios</option>
              </select>
            </p>
            <p><span class="BCL-btn" onclick="BCL.doSearchVideos()">Search for Videos</span></p>
          </div>
          <div class="section" id="request">
            <h2>Media API Request</h2>
            <p>Below is the request sent to the Media API service:</p>
            <pre><code id="mapiRequest"></code></pre>
          </div>
          <div class="section" id="jsonResponse">
            <h2>JSON Response</h2>
              <p>Below is the JSON data returned by the request:</p>
              <fieldset>
                <legend>JSON Response</legend>
                <pre><code id="mapiResponse"></code></pre>
              </fieldset>
          </div>
          <div class="section" id="processedResponse">
            <h2>Processed Response</h2>
            <p>Below is simple HTML output of the video names using the <a href="http://handlebarsjs.com">Handlebars</a> templating system:</p>
            <div id="htmlOutput"></div>
          </div>
        </div>
      </div>
    <!-- bcl scripts ============================================================ -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-smooth-scroll/1.4.13/jquery.smooth-scroll.min.js"></script>
    <script src="/en/scripts/bootstrap/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/bc-mapi.js"></script>
    <script id="pageScript" type="text/javascript">
      /******** Any scripts specific to page samples should go here *********/
      var BCL = {};
      BCL.resetPageNumber = false;
      BCL.mediaDelivery = document.getElementById("mediaDelivery");
      BCL.sortBy = document.getElementById("sortBy");
      BCL.sortByOrder = document.getElementById("sortByOrder");
      BCL.pageNumber = document.getElementById("pageNumber");
      BCL.htmlTemplate = "<ul>{{#items}}<li>{{name}}</li>{{/items}}</ul>"
      
      BCL.doSearchVideos = function() {
        if (document.getElementById("token") == "" || document.getElementById("url").value == "") {
          alert("Please enter a valid token and service URL");
        }
        BCMAPI.url = document.getElementById("url").value;
        BCMAPI.token = document.getElementById("token").value;
        BCMAPI.callback = "BCL.onSearchResponse";
        BCL.params = {};
        if (document.getElementById("all").value !== "") {
          BCL.params.all = document.getElementById("all").value.split(",");
        }
        if (document.getElementById("any").value !== "") {
          BCL.params.any = document.getElementById("any").value.split(",");
        }
        if (document.getElementById("none").value !== "") {
          BCL.params.none = document.getElementById("none").value.split(",");
        }
        if (document.getElementById("pageSize").value !== "") {
          BCL.params.page_size = document.getElementById("pageSize").value;
        }
        BCL.params.video_fields = getSelectValues(document.getElementById("videoFields")).join();
        BCL.params.media_delivery = BCL.mediaDelivery.options[BCL.mediaDelivery.selectedIndex].value;
        BCL.params.sort_by = BCL.sortBy.options[BCL.sortBy.selectedIndex].value + ":" + BCL.sortByOrder.options[BCL.sortByOrder.selectedIndex].value;
        if ((BCL.resetPageNumber) || (!BCL.pageNumber.options[BCL.pageNumber.selectedIndex])) {
            BCL.params.page_number = 0;
            BCL.resetPageNumber = false;
        } else {
            BCL.params.page_number = BCL.pageNumber.options[BCL.pageNumber.selectedIndex].value;
        }   
        BCL.params.get_item_count = true;
        BCMAPI.search(BCL.params);
      }
      BCL.onSearchResponse = function(jsonData) {
        // console.log(jsonData);
        var numberOfPages = Math.ceil(jsonData.total_count/jsonData.page_size);
        // check if a page number was selected that no longer exists with current data
        if (BCL.params.page_number > numberOfPages) {
            // redo video data search and reset the selected page number to 0
            BCL.resetPageNumber = true;
            BCL.doSearchVideos();
        } 
        // output request and response
        document.getElementById("mapiRequest").innerHTML = BCMAPI.request;
        document.getElementById("mapiResponse").innerHTML = JSON.stringify(jsonData,null,2);
        // create HTML from response and output using Handlebars
        var template = Handlebars.compile(BCL.htmlTemplate);
        var data = jsonData;
        var results = template(data);
        // update form values
        document.getElementById("htmlOutput").innerHTML = results;
        document.getElementById("totalItems").value = jsonData.total_count;
          
        BCL.formatPageDropdown(numberOfPages);

        // update syntax highlighting
        BCLSmain.BCLhighlight();
      }
      BCL.formatPageDropdown = function (numberOfPages){
        // remove any page option elements from previous requests
        if(BCL.pageNumber.length > numberOfPages) {
            for (var i = numberOfPages; i < BCL.pageNumber.length; i++) {	
                BCL.pageNumber.remove(i);
                i--;
            }
        }
        // add page option elements for each page in returned data
        for (var i = 0; i < numberOfPages; i++) {	
            if (!BCL.pageNumber[i]) {
                var option = document.createElement("option");
                option.text = i;
                BCL.pageNumber.add(option,null);
            }
        }
      }
      
      // Return an array of the selected opion values
      // select is an HTML select element
      getSelectValues = function(select) {
        var result = [];
        var options = select && select.options;
        var opt;
        for (var i = 0, iLen = options.length; i < iLen; i++) {
          opt = options[i];
          if (opt.selected) {
            result.push(opt.value || opt.text);
          }
        }
        return result;
      }
      // debugging tool - wraps BCL.log to avoid errors in IE 7 & 8
      BCL.log = function(message) {
        if (window["console"] && console["log"]) {
          var d = new Date();
          console.log(d + ": ");
          console.log(message);
        }
      }
    </script>
	</body>
</html>
