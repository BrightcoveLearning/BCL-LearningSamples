<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Test Player</title>
  // import DASH plugin CSS
  <link rel="stylesheet" href=" //players.brightcove.net/videojs-dash/2/videojs-dash.css">
  <style>
    .video-js {
      height: 325px;
      width: 610px;
    }
    #selectID {
      margin-top: 7px;
      width: 65px;
    }
  </style>
</head>

<body>
  // include in-page embed player implementation
  <video id="myPlayerID"
    data-video-id="4910007292001"
    data-account="2728142649001"
    data-player="ryI6b6eX"
    data-embed="default"
    class="video-js"
    controls></video>
  <script src="//players.brightcove.net/2728142649001/ryI6b6eX_default/index.min.js"></script>

  // div for debugging tables
  <div id="tableArea"></div>

  // import DASH plugin JavaScript
  <script src="//players.brightcove.net/videojs-dash/2/videojs-dash.min.js"></script>

  <script type="text/javascript">
    var player,
      changeQuality,
      createSelectInControlbar,
      displayReps;

    videojs('myPlayerID').ready(function () {
      player = this;

      player.on('loadedmetadata', function () {
        var selectControl;

        // display reps array for debugging purposes
        displayReps(player.dash.representations());

        // display quality select element in controlbar
        createSelectInControlbar();

        // get select element and add change event listener
        selectControl = document.getElementById('selectID');
        selectControl.addEventListener('change',changeQuality);
      });
    });

    // function that adds the HTML select element to the controlbar
    function createSelectInControlbar() {
      var newElement = document.createElement('div'),
        // dynamically build the select element
        selectControl = document.createElement('select'),
        option;
      // dynamically configure the select element and add options
      newElement.id = 'selectID';
      newElement.name = 'quality';
      newElement.className = 'selectStyle vjs-control';
      option = document.createElement('option');
      option.text = 'Quality';
      selectControl.appendChild(option);
      option = document.createElement('option');
      option.value = 'low';
      option.text = 'Low';
      selectControl.appendChild(option);
      option = document.createElement('option');
      option.value = 'high';
      option.text = 'High';
      selectControl.appendChild(option);
      newElement.appendChild(selectControl);
      // get spacer in controlbar and append select element
      spacer = document.getElementsByClassName('vjs-spacer')[0];
      spacer.setAttribute("style", "justify-content: flex-end;");
      spacer.appendChild(newElement);
    };

    function changeQuality(evt) {
      var selectedQuality,
        setToTrueSet,
        lengthOfReps = player.dash.representations().length,
        theSelect = evt.target,
        sortedArray = player.dash.representations(),
        highBandwidths,
        lowBandwidths,
        enableBandwidths;
      sortedArray.sort(function(a,b){
        if (a.bandwidth > b.bandwidth) {
            return 1;
          }
          if (a.bandwidth < b.bandwidth) {
            return -1;
          }
          // a must be equal to b
          return 0;
      });
      if (lengthOfReps > 2){
        lowBandwidths = [sortedArray[0].bandwidth, sortedArray[1].bandwidth];
        console.log('lowBandwidths ',lowBandwidths);
        highBandwidths = [sortedArray[lengthOfReps - 2].bandwidth, sortedArray[lengthOfReps - 1].bandwidth];
        console.log('highBandwidths ',highBandwidths);
        selectedQuality = theSelect.options[theSelect.selectedIndex].value;
        console.log('selectedQuality ',selectedQuality);
        if (selectedQuality === 'low') {
          enabledBandwidths = lowBandwidths;
        } else {
          enabledBandwidths = highBandwidths;
        }
        player.dash.representations().forEach(function (rep) {  
          rep.enabled(enabledBandwidths.indexOf(rep.bandwidth) === -1 ? false : true);  
        });
      };
      displayReps(player.dash.representations());
    };

    function displayReps(repArray){
      var tableArea = document.getElementById('tableArea'),
        table = document.createElement('table'),
        trHeaders = document.createElement('tr'),
        enabledHdr = document.createElement('th'),
        idHdr = document.createElement('th'),
        widthHdr = document.createElement('th'),
        heightHdr = document.createElement('th'),
        bandwidthHdr = document.createElement('th');
      enabledHdr.innerHTML = 'Enabled',
      idHdr.innerHTML = 'ID',
      widthHdr.innerHTML = 'Width',
      heightHdr.innerHTML = 'Height',
      bandwidthHdr.innerHTML = 'Bandwidth';
      trHeaders.appendChild(enabledHdr);
      trHeaders.appendChild(idHdr);
      trHeaders.appendChild(widthHdr);
      trHeaders.appendChild(heightHdr);
      trHeaders.appendChild(bandwidthHdr);
      table.appendChild(trHeaders);
      player.dash.representations().forEach(function (rep) {
        var
        tr = document.createElement('tr'),
          checkbox = document.createElement('input'),
          checkboxTd = document.createElement('td'),
          idTd = document.createElement('td'),
          widthTd = document.createElement('td'),
          heightTd = document.createElement('td'),
          bandwidthTd = document.createElement('td');

        checkbox.checked = rep.enabled();
        checkbox.type = 'checkbox';
        checkbox.onclick = function () {
          if (checkbox.checked) {
            rep.enabled(true);
          } else {
            rep.enabled(false);
          }
        };
        checkboxTd.appendChild(checkbox);
        idTd.innerHTML = rep.id;
        widthTd.innerHTML = rep.width;
        heightTd.innerHTML = rep.height;
        bandwidthTd.innerHTML = rep.bandwidth;
        tr.appendChild(checkboxTd);
        tr.appendChild(idTd);
        tr.appendChild(widthTd);
        tr.appendChild(heightTd);
        tr.appendChild(bandwidthTd);
        table.setAttribute('style', 'border:1px solid black');
        tr.setAttribute('style', 'border:1px solid black');
        table.appendChild(tr);
      });
      tableArea.appendChild(table);
    }
  </script>
</body>

</html>
