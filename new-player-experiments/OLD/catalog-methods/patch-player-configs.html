<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Untitled Document</title>
  <style type="text/css">
      .video-js {
        height: 360px;
        width: 640px;
        float: left;
      }
      .vjs-playlist {
        width: 280px;
        height: 350px;
      }
  </style>
</head>

<body>

  <script type="text/javascript">
    var baseURL = 'https://players.api.brightcove.com/v2/accounts/',
      accountId = '1752604059001',
      returnedPlayers = [];
      setRequestGetPlayers();

    // function to set up request
    function setRequestGetPlayers() {
      var responseParsed,
        options = {},
        endPoint = accountId + '/players';
      options.proxyURL = "https://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy-v2.php";
      options.url = baseURL + endPoint;
      options.requestType = "GET";
      makeRequest(options, function (response) {
        responseParsed = JSON.parse(response);
        returnedPlayers = responseParsed.items;
        var filtered_players = returnedPlayers.filter(filter_players);
        console.log('filtered_players',filtered_players);
      });
      function filter_players(event) {
        return event.description == 'For patch players Player Mgmt Sample';
      }
    }

    // function to set up request
    function setRequestMakeUpdate() {
      var callNumber = 0,
          responseParsed,
          options = {},
          requestBody = {
            "muted": true,
            "autoplay": true
          },
          baseURL = 'https://players.api.brightcove.com/v2/accounts/',
          endPoint = accountId + '/players/';
      options.proxyURL = "https://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy-v2.php";
      options.url = baseURL + endPoint;
      var currentId = videoIds[callNumber];
      options.url += currentId + '/configuration';
      console.log('options.url', options.url);
        requestBody = '{"muted": true,"autoplay": true}';
        options.requestBody = JSON.stringify(requestBody);
        options.requestType = "PATCH";
        makeRequest(options, function (response) {
          responseParsed = JSON.parse(response);
          callNumber++;
          if (callNumber < videosAraLength - 1) {
            setRequest("updateVideo");
          }
        });
      }

      function makeRequest(options, callback) {
        console.log('options in makeRequest',options);
        var httpRequest = new XMLHttpRequest(),
          response,
          requestParams,
          dataString,
          proxyURL = options.proxyURL,
          // response handler
          getResponse = function () {
            try {
              if (httpRequest.readyState === 4) {
                if (httpRequest.status >= 200 && httpRequest.status < 300) {
                  response = httpRequest.responseText;
                  // some API requests return '{null}' for empty responses - breaks JSON.parse
                  if (response === '{null}') {
                    response = null;
                  }
                  // return the response
                  callback(response);
                } else {
                  alert('There was a problem with the request. Request returned ' + httpRequest.status);
                }
              }
            } catch (e) {
              alert('Caught Exception: ' + e);
            }
          };
        /**
         * set up request data
         * the proxy used here takes the following request body:
         * JSON.strinify(options)
         */
        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open('POST', proxyURL);
        // set headers if there is a set header line, remove it
        // open and send request
        httpRequest.send(JSON.stringify(options));
      }
  </script>

</body>

</html>
