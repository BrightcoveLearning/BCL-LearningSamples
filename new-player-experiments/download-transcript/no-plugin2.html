<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Untitled Document</title>
  <style media="screen">
    textarea {
      width: 300px;
      height: 300px;
    }
  </style>
</head>

<body>

  <video id="myPlayerID"
    data-video-id="5996462763001"
    data-account="1543299976"
    data-player="default"
    data-embed="default"
    data-application-id
    class="video-js"
    controls
    width="640"
    height="360"></video>
  <script src="//players.brightcove.net/1543299976/default_default/index.min.js"></script>

  <p>See transcript here:</p>
  <textarea id="transcriptOutput"></textarea>

  <script>
    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this,
        regex = /\d\d:\d\d\.\d\d\d\s+-->\s+\d\d:\d\d\.\d\d\d.*\n/ig,
        url,
        transcriptArea = document.getElementById('transcriptOutput'),
        hiddenElement = document.createElement('a');
      myPlayer.on('loadstart',function(){
        url = myPlayer.mediainfo.textTracks[0].src;
        getFile(url, function(response) {
            if (response) {
                var responseEdited = response.replace(regex,'');
                var responseEdited = responseEdited.replace('WEBVTT','');
                var responseEdited = responseEdited.replace('&gt;','');
                var responseEdited = responseEdited.replace('&gt;','');
                transcriptArea.textContent = responseEdited;
            }
        });
      });
    });


    /**
     * get the contents of a text file
     * @param  {String} url the url of the txt file
     * @param  {Function} [callback] callback function that will process the response
     */
    function getFile(url, callback) {
        var httpRequest = new XMLHttpRequest(),
            response,
            // response handler
            getResponse = function() {
                try {
                    if (httpRequest.readyState === 4) {
                        if (httpRequest.status === 200) {
                            response = httpRequest.responseText;
                            // some API requests return '{null}' for empty responses - breaks JSON.parse
                            if (response === '{null}') {
                                response = null;
                            }
                            // return the response
                            callback(response);
                        } else {
                            callback(null);
                        }
                    }
                } catch (e) {
                    callback(null);
                }
            };
        /**
         * set up request data
         */
        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open('GET', url);
        // open and send request
        httpRequest.send();
    }
  </script>

</body>

</html>
