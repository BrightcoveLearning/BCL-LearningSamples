<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<title>Media API Exercise</title>
				<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style type="text/css">
			body {
				font-family : Helvetica,Arial,sans-serif; 
				color : #619FA8;
				width: 900px;
				padding: 0px 50px 50px 50px;
			}
			legend {
				color: #CF0050;
			}
			.button {
				background-color: #f5f5f5;
				background-image: -webkit-gradient(linear, left top, left bottom, from(#f5f5f5), to(#999999));
				background-image: -webkit-linear-gradient(top, #f5f5f5, #999999);
				background-image: -moz-linear-gradient(top, #f5f5f5, #999999);
				background-image: -o-linear-gradient(top, #f5f5f5, #999999);
				background-image: -ms-linear-gradient(top, #f5f5f5, #999999);
				background-image: linear-gradient(top, #f5f5f5, #999999);
				filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,StartColorStr='#f5f5f5', EndColorStr='#999999');
				color: #990000;
				border: #999 1px solid;
				border-radius: 10px;
				padding: 5px;
			}
			.videoTitle {
				font-weight: bold;
				color: #990000;
			}
			#pages {
				font-weight: bold;
				color: #990000;
			}
			.aside {
				color: #990000;
				font-style: italic;
				background-color: #CCC;
				border: #999 1px solid;
				border-radius: 10px;
				padding: 5px;
				width: 550px;
			}
		</style>
		<!-- Javascript Media API wrapper from opensource.brightcove.com -->
		<script type="text/javascript" src="http://files.brightcove.com/bc-mapi.js"></script>

	</head>
	<body>
		<h2>Video Data Retriever</h2>
		<p>This is a utility for dumping out the video metadata for your Video Cloud videos. Feel free to take the source code and use or modify it, but take note:</p>
		<p class="aside">This is a demonstration with a sample account. You should not post this page on a public-facing server - it is never a good idea to expose Media API tokens in page contents or source code.</p>
		<p>Enter your Media API <strong>Read</strong> token &mdash; <em>Note that if you want the URL for the video file, use the Read token with URL Access</em></p>
		<p><input id="token" size="100" value="jUPgZ3EQYo26aTy2Y7_RZ4JWOyou9XyMna9fvkmT1IiQ8a9cHlHcCQ.." /></p>
		<p>Items per page: 
			<select id="pageSize">
				<option selected="selected">5</option>
				<option>10</option>
				<option>25</option>
				<option>50</option>
				<option>100</option>
			</select>
		</p>
		<p>Total number of items: <span id="pages">???</span></p>
		<p>Page to display: <select id="pageSelector" onchange="BCL.getVideoData()">
			<option>1</option>
		</select></p>
		<p><span class="button" onclick="BCL.getVideoData()">Get Video Data</span></p>
    <fieldset>
      <legend>Video Data</legend>
			<div id="results"></div>
    </fieldset>
		<!-- the script below is a data-dumper for debugging -->
		<script type="text/javascript" src="http://files.brightcove.com/prettyprint.js"></script>
		<script type="text/javascript">
			// BCL Media API search maker -- adapted from JS-MAPI on opensource.brightcove.com
			// namespace to keep all the "global" vars together
			var BCL = {};
			BCL.date = new Date();

			BCL.getVideoData = function() {
				document.getElementById("results").innerHTML = "";
				var token = document.getElementById("token").value;
				var fields = "id,lastModifiedDate,name,shortDescription,tags";
				var custom_fields = "omsid,videotype";
				var pageSizeSelector = document.getElementById("pageSize");
				var pageSizeSelectedIndex = pageSizeSelector.selectedIndex;
				var pageSize = pageSizeSelector.options[pageSizeSelectedIndex].text;
				var pages = 1;
				var pageSelector = document.getElementById("pageSelector");
				var page_number = parseInt(pageSelector.options[pageSelector.selectedIndex].text) - 1;
				// remove any spaces
				fields = fields.replace(/\s/g,'');  
				if (token === "") {
					alert("Please enter your Media API Read token");
				}
				BCMAPI.token = token;
				BCMAPI.callback = "BCL.onSearchResponse";
				BCL.params = {};
				// use next line to limit fields returned
				BCL.params.video_fields = fields;
				BCL.params.custom_fields = custom_fields;
				BCL.params.page_size = parseInt(pageSize);
				BCL.params.page_number = page_number;
				BCL.params.get_item_count = true;
				BCMAPI.search(BCL.params);
			}
			BCL.onSearchResponse = function(jsonData) {
				console.log(jsonData);
				if (jsonData.total_count > 0) {
					document.getElementById("pages").innerHTML = jsonData.total_count;
						pages = Math.ceil(jsonData.total_count / jsonData.page_size);
					if (pageSelector.options.length !== pages) {
						pageSelector.options.length = 0;
						for (var i = 1; i <= pages; i++) {
							BCL.addOption("pageSelector",i,i);
						};
					};
				}
				else {
					document.getElementById("pages").innerHTML = "1";
				};
				for (var index in jsonData.items) {
					BCL.log(jsonData.items[index]);
				}
			}
			BCL.log = function(message) {
					var logEntry = prettyPrint(message);
					document.getElementById("results").appendChild(logEntry);
			}
			BCL.addOption = function(selectID, display, value) {
			  var obj = document.getElementById(selectID);
			  obj.options[obj.options.length] = new Option(display, value);
			}
		</script>
	</body>
</html>
