<html>
<head>
<title>HTML5 Cue-POINTS</title>
<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>
<script type="text/javascript">
		var bcExp;
		var modExp;
		var modCue;
		var modVid;
		var queuedTime;
		var cuepointdata = [
	{
	  "name" : "cue point 1",
	  "metadata" : "First cue point",
	  "videoID" : 1950728038001,
	  "type" : 1,
	  "time" : 2
	},
	{
	  "name" : "cue point 2",
	  "metadata" : "Second cue point",
	  "videoID" : 1950728038001,
	  "type" : 1,
	  "time" : 4
	},
	{
	  "name" : "cue point 3",
	  "metadata" : "Third cue point",
	  "videoID" : 1950728038001,
	  "type" : 1,
	  "time" : 6
	}
  ];
 function log(message) {
// check to see if the message is complex data and decompose if so
  if (typeof message == "object"){
	for (var prop in message){
	if (typeof message[prop] == "object") {
	  log(prop+": ");
	  log(message[prop]);
	}
	else {
	  log(prop+": "+message[prop]);
	}
  }
  }
  else {
	document.getElementById("logger").value += message + "\n";
  }
}
	  function onTemplateLoaded(experienceId)
	  {
		log("on Template Loaded fired");
		bcExp = brightcove.api.getExperience(experienceId);
		var APIModules = brightcove.api.modules.APIModules;
		var TEMPLATE_READY = brightcove.api.events.ExperienceEvent.TEMPLATE_READY;
		modExp = bcExp.getModule(APIModules.EXPERIENCE);
		modCue = bcExp.getModule(APIModules.CUE_POINTS);
		modVid = bcExp.getModule(APIModules.VIDEO_PLAYER);
		modExp.addEventListener(TEMPLATE_READY, onTemplateReady);
	  }
	  function onTemplateReady(event) 
	  {
		log("on Template Ready fired");
		var TEMPLATE_READY = brightcove.api.events.ExperienceEvent.TEMPLATE_READY;
		modExp.removeEventListener(TEMPLATE_READY, onTemplateReady);
		// Vineet, you had modVid in the following line
		modCue.addEventListener(brightcove.api.events.CuePointEvent.CUE, onCuePointReach);
		modVid.addEventListener(brightcove.api.events.MediaEvent.BEGIN, onMediaBegin);
		// removing existing cue points
		modCue.clearAdCuePoints(1950728038001);
		modCue.clearCodeCuePoints(1950728038001);
		// adding new cuepoints
		modCue.addCuePoints(1950728038001, cuepointdata);
		log("cue points added");
	  }
	  var video;
	  function videoHandler(result)
	  {
	  video=result;
	  log("Currently Loaded Video = " + video.id);
	  var video_id = video.id;
	  modCue.getCuePoints(video_id,videoCueHandler);
	  }
	  var currentcues;
	  function videoCueHandler(result)
	  {
	  currentcues = result;
	  for (var i=0; i < currentcues.length; i++)
		{
		  if (currentcues[i].type == 1) 
		  {
			log("Cue-Point at : "+currentcues[i].time + "seconds"+ "," +"Cue-Point Name: " +currentcues[i].name);
		  }
		}
	  }
	  function onMediaBegin(evt)
	  {
	  log("MEDIA BEGIN fired");
	  modVid.getCurrentVideo(videoHandler);
	  }
	  function onCuePointReach(event)
	  {
	  log("CUE POINT Reached");
	  log(event.name);
	  }
	  function SetCuePoints(vidID)
	  {
	  modVid.loadVideoByID(vidID);
	  modVid.play();
	  }
	  </script>
</head>
<body>
<div id="player1">
<!--
By use of this code snippet, I agree to the Brightcove Publisher T and C 
found at https://accounts.brightcove.com/en/terms-and-conditions/. 
-->
<object id="myExperience" class="BrightcoveExperience">
  <param name="bgcolor" value="#FFFFFF" />
  <param name="width" value="480" />
  <param name="height" value="270" />
  <param name="playerID" value="1847432356001" />
  <param name="playerKey" value="AQ~~,AAAAksdab5E~,uSnu82XezIZ7ueRQ1JqfT4-A0whaLgE3" />
  <param name="isVid" value="true" />
  <param name="isUI" value="true" />
  <param name="dynamicStreaming" value="true" />
   <param name="templateLoadHandler" value="onTemplateLoaded" />
  <param name="includeAPI" value="true" />
  <param name="dynamicStreaming" value="true" />
</object>
<!-- 
This script tag will cause the Brightcove Players defined above it to be created as soon
as the line is read by the browser. If you wish to have the player instantiated only after
the rest of the HTML is processed and the page load is complete, remove the line.
-->
<script type="text/javascript">brightcove.createExperiences();</script> 
</div>
<!-- End of Brightcove Player -->
<br/>
<button onclick="SetCuePoints('1950728038001')">Load Video 1</button>
<button onclick="SetCuePoints('845514906001')">Load Video 2</button>
<br/>
<!-- Begin Script Logger --> 
<h2>Log Results</h2> 
<div id="BCscriptingLog"> 
<p><textarea id="logger" name="logger" rows="20" cols="60"></textarea></p></div> 
<!-- End Debugging Helper --> 
</body>
</html>