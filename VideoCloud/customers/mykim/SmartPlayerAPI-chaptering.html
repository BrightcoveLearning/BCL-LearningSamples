	<!DOCTYPE html>
<html>
	<head>
		<title>Chaptered Video Sample</title>
	</head>
	<body>
		<h1>Chaptered Video</h1>
<div id="BCL_player">
	<div style="display:none"></div>
  <script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>
  <object id="myExperience" class="BrightcoveExperience">
    <param name="bgcolor" value="#FFFFFF" />
    <param name="width" value="870" />
    <param name="height" value="349" />
    <param name="playerID" value="1651416805001" />
    <param name="playerKey" value="AQ~~,AAABDi-JSEE~,gimkI1WDEZvYd6TLx4xfwTSY7Yu_Xexv" />
    <param name="isVid" value="true" />
    <param name="isUI" value="true" />
    <param name="dynamicStreaming" value="true" />
    <param name="includeAPI" value="true" />
    <param name="templateReadyHandler" value="BCL.onTemplateReady" />
    <param name="templateLoadHandler" value="BCL.onTemplateLoaded" />
  </object>
  <script type="text/javascript">brightcove.createExperiences();</script>
  <!-- End of Brightcove Player -->
</div>
<div id="BCL_chapters"></div>
<!-- include handlebars.js templating system -->
<script type="text/javascript" src="http://files.brightcove.com/handlebars-1.0.0.beta.6.js"></script>
<script type="text/javascript">
	// namespace for everything global
	var BCL = {};
  // handlebar template for selector
  BCL.chaptersTemplate = "<select id='chapterSelector' onChange=\"BCL.playChapter(this.options[this.selectedIndex].value)\"><option>Go to Chapter</option>{{#cuePointData}}<option value=\"{{time}}\">{{name}}</option>{{/cuePointData}}</select>";
  // event listener for template loaded
  BCL.onTemplateLoaded = function(id) {
    BCL.log("ID: " + id);
  }
  // event listener for the player being ready
  BCL.onTemplateReady = function(event) {
  BCL.log("hello");
    BCL.log("BCL.onTemplateReady");
    // get modules
    BCL.player = brightcove.api.getExperience("myExperience");
    BCL.videoPlayer = BCL.player.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER);
    BCL.cuePointsModule = BCL.player.getModule(brightcove.api.modules.APIModules.CUE_POINTS);
    // set event listener for media change
    BCL.videoPlayer.addEventListener(brightcove.api.events.MediaEvent.CHANGE, BCL.onMediaChange);
    // call media change handler for first video
    BCL.onMediaChange(null);
   }
  BCL.onMediaChange = function(event) {
    BCL.log(event);
    // capture the video id
    BCL.videoPlayer.getCurrentVideo( function(videoDTO) {
        // get cue points for the video
        BCL.getCuePoints(videoDTO.id);
      });
  }
  // get cue points
  BCL.getCuePoints = function(videoID) {
    BCL.cuePointsModule.getCuePoints(videoID, function(cuePointData) {
      BCL.log(cuePointData);
      if (cuePointData) {
        // make an object to pass to Mark.up
        var cuePointDataObj = {};
        // sort the array to get cue points in order
        cuePointData.sort( function(a,b) {
          return a.time - b.time;
        });
        // remove the preroll and postroll cue points
        cuePointData.splice(0,1);
        cuePointData.splice((cuePointData.length -1),1);
        // if there are cue points left, chapter them
        BCL.log("cuePointData.length: " + cuePointData.length);
        if (cuePointData.length > 0) {
          cuePointDataObj.cuePointData = cuePointData;
          // populate the template with data
          var template = Handlebars.compile(BCL.chaptersTemplate);
          var data = cuePointDataObj;
          var results = template(data);
          document.getElementById("BCL_chapters").innerHTML = results;
          // BCL.videoPlayer.play();
        }
      }
      else {
        document.getElementById("BCL_chapters").innerHTML = "";
      }
    });
  };
  // play the chapter
  BCL.playChapter = function(time) {
    BCL.log("starting the chapter");
    /** in case the video hasn't been started,
    * need to get it started first and make sure
    * it's playing before doing anything else
    **/
    BCL.videoPlayer.getIsPlaying(function(data) {
      if (data == true) {
        BCL.log(time);
        BCL.videoPlayer.seek(time);
      }
    // function keeps calling itself till video is playing
      else {
          // function recalls itself till result is true
          BCL.videoPlayer.play();
          BCL.videoPlaying();
        }
    });
  }
  BCL.log = function(message) {
    if (window["console"] && console["log"]) {
      var d = new Date();
      console.log(d + ": " + message);
    }
  }
</script>
	</body>
</html>
